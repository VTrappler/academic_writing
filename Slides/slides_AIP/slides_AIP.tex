\documentclass[11pt]{beamer}
\usetheme{metropolis}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{subfig}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepackage{multimedia}
%\usepackage{booktabs}
\newcommand{\Ex}{\mathbb{E}}
\newcommand{\Var}{\mathbb{V}\mathrm{ar}}
\newcommand{\Prob}{\mathbb{P}}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\newcommand{\Cov}{\textsf{Cov}}
\newcommand{\tra}{\mathrm{tr}}
\newcommand{\yobs}{\bm{y}^{\mathrm{obs}}}
\newcommand{\kest}{\hat{\bm{k}}}
\newcommand{\Uspace}{\mathbb{U}}
\newcommand{\Kspace}{\mathbb{K}}
\usetikzlibrary{positioning}
\DeclareMathOperator*{\KL}{\textsf{KL}}
\graphicspath{{../Figures/}}

\definecolor{blkcol}{HTML}{E1E1EA}
\definecolor{blkcol2}{RGB}{209, 224, 224}

% \definecolor{BlueTOL}{HTML}{222255}
% \definecolor{BrownTOL}{HTML}{666633}
% \definecolor{GreenTOL}{HTML}{225522}
% \setbeamercolor{normal text}{fg=BlueTOL,bg=white}
% \setbeamercolor{alerted text}{fg=BrownTOL}
% \setbeamercolor{example text}{fg=GreenTOL}

\setbeamercolor{block title}{bg = blkcol}
\setbeamercolor{block body}{bg = blkcol!50}

\setbeamerfont{author}{size=\footnotesize}

\title{Parameter control in the presence of uncertainties}
\subtitle{Robust Estimation of Bottom friction}
\author{{\large Victor Trappler} \hfill \texttt{victor.trappler@univ-grenoble-alpes.fr} \\
  É. Arnaud, L. Debreu, A. Vidard \\
  AIRSEA Research team (Inria)\hfill \texttt{team.inria.fr/airsea/en/}\\
  Laboratoire Jean Kuntzmann}


\institute{\begin{center}
\includegraphics[scale=0.20]{INRIA_SCIENTIFIQUE_UK_CMJN}
\includegraphics[scale=0.20]{ljk}
\end{center}}

\date{\textbf{AIP2019, Grenoble, 2019}}
\setcounter{tocdepth}{1}

\begin{document}
\frame{
  \maketitle
}
\metroset{sectionpage=none, subsectionpage=none}
\section{Introduction}

\frame{
  \frametitle{Processus of modelling of physical systems}
 %  \begin{center}
%   \scalebox{1}{\input{../Figures/flowchart_modelling_uncertainties_vert}}
% \end{center}  
  Uncertainties and errors are introduced at each stage of the modelling, by simplifications, parametrizations\dots

  In the end, we have a set of parameters we want to calibrate, but how can we be sure that this calibration is acting upon the errors of the modelling, and does not compensate the effect of the natural variability of the physical system?
}
\frame{
\frametitle{Outline}
\tableofcontents
}
\metroset{sectionpage=progressbar, subsectionpage=none}

\section{Deterministic problem}
\frame[t]{
\frametitle{Computer code and inverse problem}
\begin{itemize}
	\item[Input] 
	\begin{itemize}
		\item $\bm{k}$: Control parameter%Bottom friction (spatially distributed)
		\item $\bm{u}$: Environmental variables (fixed and known)
	\end{itemize}
	\item[Output] \begin{itemize}
          \item $\mathcal{M}(\bm{k},\bm{u})$: Quantity to be compared to observations%Sea surface height, at predetermined time of the simulation and at certain location
	\end{itemize}
      \end{itemize}
      
\vfill
\only<1>{\input{../Figures/comp_code.pgf}}
\only<2>{\input{../Figures/inv_prob.pgf}}
}
\frame{
\frametitle{Data assimilation framework}
We have $\yobs = \mathcal{M}(\bm{k}_{\mathrm{ref}},\bm{u}_{\mathrm{ref}})$ with $\bm{u}_{\mathrm{ref}} = \bm{u}$
\begin{equation*}
\hat{\bm{k}} = \argmin_{\bm{k}\in\Kspace} J(\bm{k}) = \argmin_{\bm{k}\in\Kspace}\frac12 \|\mathcal{M}(\bm{k},\bm{u}) - \bm{y}^{\mathrm{obs}} \|^2
\end{equation*}
\begin{itemize}
\item[$\rightarrow$] Deterministic optimization problem
\item[$\rightarrow$] Possibly add regularization
\item[$\rightarrow$] Classical methods: Adjoint gradient and Gradient-descent
\end{itemize}
BUT
\begin{itemize}
\item What if $\bm{u} \neq \bm{u}_{\mathrm{ref}}$?
\item Does $\hat{\bm{k}}$ compensates the errors brought by this misspecification?
% \item How well will $\bm{\hat{k}}$ perform under other conditions?
\end{itemize}
}
\frame{
\frametitle{Context}
\begin{itemize}
\item The friction $\bm{k}$ of the ocean bed has an influence on the water circulation
\item Depends on the type and/or characteristic length of the asperities 
\item Subgrid phenomenon
\item $\bm{u}$ parametrizes the BC
\end{itemize}
\begin{center}
\scalebox{.9}{\input{../Figures/hauteureau.tikz}}
\end{center}
}


\section{Dealing with uncertainties}
\frame{
  \frametitle{Different types of uncertainties}
  \begin{block}{Epistemic or aleatoric uncertainties?~\cite{walker_defining_2003}}
\begin{itemize}
\item Epistemic uncertainties: From a lack of knowledge, that can be reduced with more research/exploration
\item Aleatoric uncertainties: From the inherent variability of the system studied, operating conditions
\end{itemize}
\end{block}
$\rightarrow$ But where to draw the line?

Our goal is to take into account the aleatoric uncertainties in the estimation of our parameter.
}

\frame[t]{
\frametitle{Aleatoric uncertainties}
Instead of considering $\bm{u}$ fixed, we consider that $\bm{U}$ is a random variable (pdf $\pi(\bm{u})$), and the output of the model depends on its realization. \\
\vfill
\only<1>{\input{../Figures/inv_prob.pgf}}
\only<2>{\input{../Figures/comp_code_unc_inv.pgf}}
\vfill
}

\frame{
\frametitle{The cost function as a random variable}
\begin{itemize}
\item Output of the computer code ($\bm{u}$ is an input):
\begin{equation*}
    \mathcal{M}(\bm{k},\alert{\bm{u}})
\end{equation*}
\item The (deterministic) quadratic error is now
\begin{equation*}   
  J(\bm{k},\alert{\bm{u}}) =  \frac12\|\mathcal{M}(\bm{k},\alert{\bm{u}}) - \yobs\|^2
\end{equation*}
\end{itemize}

\begin{equation*}
  ''\hat{\bm{k}} = \argmin_{\bm{k}\in\Kspace} J(\bm{k},\alert{\bm{u}})'' \text{ but what can we do about } \bm{u} ?
\end{equation*}
}

\frame{
  \frametitle{Toy Problem: Influence of misspecification of $\bm{u}_{\mathrm{ref}}$}
  Minimization performed on $\bm{k}\mapsto J(\bm{k},\Ex[\bm{U}])$, for different $\bm{u}_{\mathrm{ref}}$: Naïve approach
  \begin{center}
    \includegraphics[width=.8\textwidth]{optimization_using_misspecified_uref_4d}
  \end{center}
}

\frame{
  \frametitle{Robust Estimation of parameters}
  \begin{itemize}
    \item Main objectives:
    \begin{itemize}
    \item[I.] Define criteria of robustness, based on $J(\bm{k},\bm{u})$, that will depend on the final application
    \item[II.] For each criterion, be able to compute an estimate $\hat{\bm{k}}$ in a reasonable time
    \end{itemize}
  \item Questions to be answered along the way:
    \begin{itemize}
    \item Good exploration of $\Uspace$, based on the density of $\bm{U}$ (Design of Experiment: LHS, Monte-Carlo, OA,\dots~?)
    \item Deal with dimension of $\Kspace$?
    \end{itemize}
  \end{itemize}
}



\metroset{sectionpage=none, subsectionpage=progressbar}

\section{Robust minimization}

\subsection{Criteria of robustness}

\frame{
  \frametitle{Non-exhaustive list of ``Robust'' Objectives }
\begin{itemize}
% \item Global Optimum: $ \min_{(\bm{k},\bm{u})} J(\bm{u},\bm{k})$ $ \longrightarrow $ EGO
\item Worst case: $$ \min_{\bm{k} \in \Kspace} \left\{\max_{\bm{u} \in \Uspace} J(\bm{k},\bm{u})\right\}$$
\item M-robustness~\cite{lehman_designing_2004}: $$\min_{\bm{k}\in\Kspace} \Ex_{\bm{U}}\left[J(\bm{k},\bm{U})\right]$$
\item V-robustness~\cite{lehman_designing_2004}: $$\min_{\bm{k}\in\Kspace} \Var_{\bm{U}}\left[J(\bm{k},\bm{U})\right]$$
\item Multiobjective~\cite{baudoui_optimisation_2012}: $$ \text{Pareto frontier}
  $$
% \item Region of failure given by $J(\bm{k},\bm{u})>T$~\cite{bect_sequential_2012}: $$\max_{\bm{k} \in \Kspace} R(\bm{k}) = \max_{\bm{k}\in \Kspace} \Prob_{\bm{U}}\left[J(\bm{k},\bm{U}) \leq T \right]$$
\item Best performance attainable for each configuration $\bm{u}^i \sim \bm{U}$
\end{itemize}
}

% \frame{
%   \frametitle{Toy Problem: Minimization of mean value}
%   \vspace{-5ex}
%    \begin{center}
%     {\includegraphics[height = .8\textheight, width = \linewidth]{mean_minimization_illustration}}
%   \end{center}
%   \vspace{-3ex}
%    $\longrightarrow$ Quite different from the value $\bm{k} \approx 0.1$ obtained by optimization knowing the true value of $\bm{u}_{\mathrm{ref}}$ 
% }

\frame{
  \frametitle{``Most Probable Estimate'', and relaxation}%
  Main idea: For each $\bm{u}^i \sim \bm{U}$, compare the value of the cost function to its optimal value $J^*(\bm{u}^i)$
    \begin{columns}
      \begin{column}{0.6\textwidth}
      The minimizer as a random variable:
      \begin{equation*}
        \bm{K}^* = \argmin_{\bm{k}\in\Kspace} J(\bm{k},\alert<1>{\bm{U}})
      \end{equation*}
      $\longrightarrow$ estimate its density (how often is the value $\bm{k}$ a minimizer)
      \begin{align*}
        p_{\bm{K}^*}(\bm{k})
      \end{align*}
      % \begin{align*}
      %   R(\bm{k}) & = \Prob_{\bm{U}}\left[\bm{k} = \argmin_{\tilde{\bm{k}}} J(\tilde{\bm{k}},\bm{U}) \right] \\
      %   \only<1>{\phantom{R_{\alpha}(\bm{k})} & = \Prob_{\bm{U}}\left[J(\bm{k},\bm{U}) \leq \phantom{\alpha}\min_{\tilde{\bm{k}}} J(\tilde{\bm{k}},\bm{U})\right]}
      %                                           \only<2>{R_{\alert{\alpha}}(\bm{k}) & = \Prob_{\bm{U}}\left[J(\bm{k},\bm{U}) \leq \alert{\alpha}\min_{\tilde{\bm{k}}} J(\tilde{\bm{k}},\bm{U})\right]}
      %          \end{align*}%
             % \begin{align*}
             %            R(\bm{k}) &=\Prob_{\bm{U}}\left[\bm{k} = \argmin_{\tilde{\bm{k}}} J(\tilde{\bm{k}},\bm{U}) \right] \\
             %            R_{\alpha}(\bm{k}) & = \Prob_{\bm{U}}\left[J(\bm{k},\bm{U}) \leq \alpha\min_{\tilde{\bm{k}}} J(\tilde{\bm{k}},\bm{U})\right]
             %          \end{align*}
             %        }
               \onslide<2>{$\longrightarrow$ Relaxation of the constraint with $\alpha\geq1$}
                  \end{column}%
                  \begin{column}{0.5\textwidth}
                    \begin{center}
                      \includegraphics[scale=0.3]{summary_criteria}
                    \end{center}
                    % \pause
                    % Idea: Relaxation of the constraint:
                    % \begin{equation*}
                    %   R_{\alpha}(\bm{k}) = \Prob\left[J(\bm{k},\bm{U}) \leq \alpha \min_{\tilde{\bm{k}}} J(\tilde{\bm{k}},\bm{U})\right],\quad \alpha \geq 1
                    % \end{equation*}
                    % and increase $\alpha$ until $\max_{\bm{k}} R_{\alpha}(\bm{k})$ reaches a level of confidence.
                  \end{column}
                \end{columns}
              }
\begin{frame}
  \frametitle{Tuto}
  \begin{center}
  \includegraphics<1>[scale=0.5]{relaxation_tuto_1}
  \includegraphics<2>[scale=0.5]{relaxation_tuto_2}
  \includegraphics<3>[scale=0.5]{relaxation_tuto_3}
  \includegraphics<4>[scale=0.5]{relaxation_tuto_4}
\end{center}
\end{frame}


% \frame{
% \frametitle{Illustration of the relaxation}
% \begin{center}
% \scalebox{0.45}{%
% \input{../Figures/regions_relax_alpha2.pgf}}
% \end{center}
% }


              

\begin{frame}
  \frametitle{MPE and relaxation}
  \begin{center}
    % \includegraphics<1>[height=\textheight]{alpha_check}
    \includegraphics<1>[height=.95\textheight, width = \textwidth]{illustration_alpha0}
    \includegraphics<2>[height=.95\textheight, width = \textwidth]{illustration_alpha1}
    \includegraphics<3>[height=.95\textheight, width = \textwidth]{illustration_alpha2}
    \includegraphics<4>[height=.95\textheight, width = \textwidth]{illustration_alpha3}
    \includegraphics<5>[height=.95\textheight, width = \textwidth]{illustration_alpha4}
    \includegraphics<6>[height=.95\textheight, width = \textwidth]{illustration_alpha5}
    \includegraphics<7>[height=.95\textheight, width = \textwidth]{illustration_alpha6}
    \end{center}
\end{frame}


\section{Surrogates}
\subsection{\small{How to compute $\hat{\bm{k}}$ in a reasonable time?}}
\frame[t]{
\frametitle{Why surrogates?}
\begin{itemize}
\item Computer model: \alert{expensive to run}
\item $\dim \Kspace$, $\dim \Uspace$ can be very large: \alert{curse of dimensionality}
\item Uncertainties upon $\bm{u}$ maybe incorporated directly in the surrogate (PCE:~\cite{sudret_polynomial_2015})
\end{itemize}
\vfill
\begin{center}
	\only<1>{\scalebox{0.9}{\input{../Figures/comp_code_surro.pgf}}}	
	\only<2>{\scalebox{0.9}{\input{../Figures/surrogate.pgf}}}
\end{center}
\vfill
}
% \frame{
%   \frametitle{Application on the calibration of the bottom friction}
%   \frametitle{MPE and relaxation: SWE toy problem, $\dim \Kspace=1$, $\dim \Uspace=2$}
%   \only<1>{Known $\bm{u}_{\mathrm{ref}}=\Ex[\bm{U}]$}
%   \only<2>{$\bm{u}_{\mathrm{ref}} = \Ex[\bm{U}] + (-0.2, -0.1) $}
%   \only<3>{$\bm{u}_{\mathrm{ref}} = \Ex[\bm{U}] + (-0.1, +0.2) $}
%   \only<4>{$\bm{u}_{\mathrm{ref}} = \Ex[\bm{U}] + (+0.2, +0.1) $}
%   \only<5>{$\bm{u}_{\mathrm{ref}} = \Ex[\bm{U}] + (+0.1, -0.2) $}
%   \begin{center}
%     % \includegraphics<1>[height=\textheight]{alpha_check}
%     \includegraphics<1>[height=.8\textheight, width = \textwidth]{alpha_checkref__previous_eval}
%     \includegraphics<2>[height=.8\textheight, width = \textwidth]{alpha_check_AmPm_previous_eval}
%     \includegraphics<3>[height=.8\textheight, width = \textwidth]{alpha_check_AmPp_previous_eval}
%     \includegraphics<4>[height=.8\textheight, width = \textwidth]{alpha_check_ApPp_previous_eval}
%     \includegraphics<5>[height=.8\textheight, width = \textwidth]{alpha_check_ApPm_previous_eval}
%     \end{center}
%   }
\metroset{sectionpage=progressbar, subsectionpage=none}

\section{Conclusion}
\frame{
\frametitle{Conclusion}
\begin{block}{Wrapping up}
\begin{itemize}
\item Problem of a ``good'' definition of robustness
\item Strategies rely heavily on surrogate models, to embed aleatoric uncertainties directly in the modelling
\end{itemize}
\end{block}


\begin{block}{Perspective and future work}
\begin{itemize}
\item Cost of computer evaluations $\rightarrow$ limited number of runs?
\item Dimensionality of the input space $\rightarrow$ reduction of the input space?
\item How to deal with uncontrollable errors $\rightarrow$ realism of the model?
\end{itemize}
\end{block}
}
\begin{frame}[allowframebreaks]
  \frametitle{References}
\bibliographystyle{alpha}
\bibliography{../../Documents/bibzotero}
\end{frame}
\end{document}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
